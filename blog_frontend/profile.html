<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile page</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>

<body>

    <div class="container">
        <div class="profile-info">
            <img src="assets/blog-profile-picture.jpeg" alt="" width="120" height="120">
            <div>
                <p>Feifei Wang </p>
                <p>I'm a Chinese American</p>
                <a href="#">123,000 followers</a> . <a href="#">143 following</a>
                <div class="profile-action-btns">
                    <button id="followBtn"><i class="bi bi-person-check"></i> following</button>
                    <button><i class="bi bi-bell"></i> Notify me</button>
                    <button><i class="bi bi-chat-left"></i> Message</button>
                    <button><i class="bi bi-three-dots"></i></button>
                </div>
            </div>
        </div>
        <p>I write about things I care about, often with great enthusiasm and/or contempt. I no longer assume “good
            faith.” If your answer/comment isn’t blatantly progressive, I will assume you are a shitty Trump supporter
            and block you.
        </p>
        <div class="blogpost-profile">
            <img src="assets/blog-profile-picture.jpeg" alt="" width="50" height="50">
            <div>
                <p><strong>Feifei Wang</strong> . Following</p>
                <p>Lives in Seattle, WA (2021-present) . 2h</p>
            </div>
        </div>
        <p class="blogpost-title">Why can't people realize that their words can hurt?</p>
        <p class="blogpost-body">
            But they do.

            Oh, they do know words can hurt. Those parents who verbally abuse their children would never say the
            same thing to their bosses or a police officer. People who say mean things to you most definitely know
            how to sweet talk when they need something from you.

            Most people know they can use words to get emotional reactions. Most of us have empathy. Most of us
            learn how to socialize with others. Most of us learn how to use words to praise, delight, entertain, and
            hurt long before our teenage years.

            They know their words hurt you. They either do not are, or they want to hurt you. They are doing it on
            purpose.

            Sure, it is easier to find excuses for them. They might be our family and loved ones. They might be
            people we respect and admire. It’s easier for us to take the pain if we lie to ourselves: “but they
            don’t know how much their words hurt.” Or “Even if they say mean things, they do care about us.”

            No, they do not.
        </p>
        <div class="post-action-btns">
            <div>
                <button class="like-btn" id="likeBtn"><i class="bi bi-arrow-up-circle"></i> upvote</button>
                <button class="comment-btn" id="commentBtn"><i class="bi bi-chat"></i></button>
                <button class="share-btn" id="shareBtn"><i class="bi bi-share"></i></button>
            </div>
            <button class="more-btn" id="moreBtn"><i class="bi bi-three-dots"></i></button>
        </div>
        <div class="comment-container">
            <div class="comment-action-btns">
                <img src="assets/blog-profile-picture-2.jpeg" alt="" width="50" height="50">
                <input type="text" name="comment" id="commentInput" class="w-40 p-sm" placeholder="Add a comment...">
                <input type="submit" value="Add comment" class="p-sm bg-blue">
            </div>
            <div class="comment-box">

                <div class="sort-comments">
                    <p>comments</p>
                    <select name="commentsortoptions" id="commentSortOptions">
                        <option value="recommended">Recommended</option>
                        <option value="recommended">Most Recent</option>
                        <option value="recommended">Least Recent</option>
                    </select>
                </div>
                <hr>
                <div class="comment-box-profile">
                    <img src="assets/blog-profile-picture.jpeg" alt="" width="50" height="50">
                    <span><strong>Feifei Wang</strong> . Following</span>
                </div>
                <div class="comment-content">
                    <p>Well said!
                        I may or may not have linked this in a comment before (and I apologize if I have).
                    </p>
                </div>
            </div>
        </div>

    </div>


    <script>
        const followBtn = document.getElementById('followBtn');
        const testData = {
            'userName': 'Abdul'
        }
        function doNothing() {
            console.log('do nothing');
        }

        async function refreshAccessToken() {
            const refreshToken = localStorage.getItem("refresh_token");

            if (!refreshToken) {
                console.error("No refresh token found. User needs to log in.");
                return;
            }

            const response = await fetch("http://127.0.0.1:8000/api/token/refresh/", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ refresh: refreshToken }),
            });

            if (!response.ok) {
                console.error("Failed to refresh token. User needs to log in again.");
                return;
            }

            const data = await response.json();
            localStorage.setItem("access_token", data.access);
            console.log("Access token refreshed!");
        }

        async function sendDataToBackend(url, data, action) {
            let token = localStorage.getItem("access_token");

            let response = await fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${token}`,
                },
                body: JSON.stringify(data),
            });

            // If token is expired, refresh it and retry
            if (response.status === 401) {
                console.log("Token expired, refreshing...");
                await refreshAccessToken();
                token = localStorage.getItem("access_token");

                response = await fetch(url, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${token}`,
                    },
                    body: JSON.stringify(data),
                });
            }

            return response.json();
        }

        const url = 'http://127.0.0.1:8000/blogposts/follow'
        followBtn.addEventListener('click', function (e) {
            sendDataToBackend(url, testData, doNothing);
        });
    </script>
</body>

</html>